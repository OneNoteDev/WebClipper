/*
The MIT License (MIT)

Copyright (c) 2016 OneNoteDev

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.OneNotePicker=t()}}(function(){return function t(e,o,n){function i(s,a){if(!o[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(r)return r(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var u=o[s]={exports:{}};e[s][0].call(u.exports,function(t){var o=e[s][1][t];return i(o?o:t)},u,u.exports,t,e,o,n)}return o[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(t,e,o){"use strict";var n;!function(t){t.tab=9,t.enter=13}(n||(n={}));var i=function(){function t(t){this.props=t,this.state=this.getInitialState(),this.refs={}}return t.prototype.getInitialState=function(){return{}},t.prototype.setState=function(t){m.startComputation();for(var e in t)t.hasOwnProperty(e)&&(this.state[e]=t[e]);m.endComputation()},t.prototype.ref=function(t){var e=this;return{config:function(o){e.refs[t]=o}}},t.prototype.onElementDraw=function(t){return t=t.bind(this),{config:function(e,o){t(e,!o)}}},t.prototype.onElementFirstDraw=function(t){return t=t.bind(this),{config:function(e,o){o||t(e)}}},t.prototype.enableInvoke=function(t,e,o){return void 0===e&&(e=0),t&&(t=t.bind(this,o)),{onclick:function(e){t&&t(e)},onkeyup:function(e){var o=e.currentTarget;e.which===n.enter?"A"===o.tagName&&o.hasAttribute("href")||t&&t(e):e.which===n.tab&&(o.style.outlineStyle="")},onmousedown:function(t){var e=t.currentTarget;e.style.outlineStyle="none"},tabIndex:e}},t.componentize=function(){var t=this,e=function(){};return e.controller=function(e){return new t(e)},e.view=function(t,e){return t.props=e,t.render()},e},t}();o.ComponentBase=i},{}],2:[function(t,e,o){"use strict";var n=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},i=t("../componentBase"),r=t("../../constants"),s=t("../../utils"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.render=function(){return{tag:"div",attrs:{id:r.Constants.Ids.saveToLocationContainer,className:"SaveToLocationContainer"},children:[{tag:"a",attrs:Object.assign({id:r.Constants.Ids.sectionLocationContainer,role:"button",style:"outline-style: none;"},this.enableInvoke(this.props.onSectionLocationContainerClicked,this.props.tabIndex),{"aria-expanded":this.props.expanded}),children:[{tag:"div",attrs:{className:"OpenSectionPickerArrow"},children:[{tag:"img",attrs:{className:"arrowDown",src:s.Utils.getImageResourceUrl("dropdown_arrow.png")}}]},{tag:"div",attrs:{className:"SectionLocation",title:this.props.textToDisplay},children:[this.props.textToDisplay]}]}]}},e}(i.ComponentBase),c=a.componentize();o.CurrentlySelectedSectionComponent=c},{"../../constants":12,"../../utils":16,"../componentBase":1}],3:[function(t,e,o){"use strict";var n=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},i=t("../componentBase"),r=t("../../utils"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.getInitialState=function(){return{isOpened:this.isPartOfCurSectionIdPath()}},e.prototype.isPartOfCurSectionIdPath=function(){return!(!this.props.curSectionIdPath||this.props.curSectionIdPath[0]!==this.getId())},e.prototype.onClicked=function(t,e){this.setState({isOpened:!this.state.isOpened}),e.stopPropagation()},e.prototype.render=function(){var t=this.getDirectChildren(),e=this.state.isOpened?"Opened":"Closed",o=this.getEntityClassName()+" "+e,n=this.getLabel();return{tag:"li",attrs:Object.assign({role:"treeitem",className:o},this.enableInvoke(this.onClicked.bind(this),this.props.tabIndex,this.getId()),{"aria-expanded":this.state.isOpened}),children:[{tag:"div",attrs:{className:"EntityImageAndNameContainer"},children:[{tag:"div",attrs:{className:"ExpandCollapseContainer"},children:[{tag:"div",attrs:{className:"Expand"},children:[{tag:"img",attrs:{className:"ExpandImage",src:r.Utils.getImageResourceUrl("arrow_right.png")}}]},{tag:"div",attrs:{className:"Collapse"},children:[{tag:"img",attrs:{className:"CollapseImage",src:r.Utils.getImageResourceUrl("arrow_down.png")}}]}]},{tag:"div",attrs:{className:"EntityImage"},children:[{tag:"img",attrs:{className:this.getImageClassName(),src:this.getImagePath()}}]},{tag:"div",attrs:{className:"EntityNameContainer"},children:[{tag:"label",attrs:{className:"EntityName"},children:[n]}]}]},{tag:"ul",attrs:{role:"group"},children:[t]}]}},e}(i.ComponentBase);o.ExpandableEntityComponentBase=s},{"../../utils":16,"../componentBase":1}],4:[function(t,e,o){"use strict";var n=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},i=t("../componentBase"),r=t("../../constants"),s=t("../../utils"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.render=function(){return{tag:"img",attrs:{id:r.Constants.Ids.loadingImage,src:s.Utils.getImageResourceUrl("loading_circle.gif"),className:"SectionPickerState SectionPickerLoading"}}},e}(i.ComponentBase),c=a.componentize();o.LoadingElementComponent=c},{"../../constants":12,"../../utils":16,"../componentBase":1}],5:[function(t,e,o){"use strict";var n=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},i=t("./expandableEntityComponentBase"),r=t("./sectionComponent"),s=t("./sectionGroupComponent"),a=t("../../utils"),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.getDirectChildren=function(){var t=this.getChildSectionGroups(),e=this.getChildSections();return e.forEach(function(e){t.push(e)}),t},e.prototype.getChildSectionGroups=function(){var t=this,e=[],o=this.props.notebook.sectionGroups;return o&&o.forEach(function(o){var n,i=t.props.path+" > "+o.name;t.isPartOfCurSectionIdPath()&&(n=t.props.curSectionIdPath.splice(1)),e.push(m.component(s.SectionGroupComponent,{curSectionId:t.props.curSectionId,path:i,sectionGroup:o,onSectionClicked:t.props.onSectionClicked,curSectionIdPath:n,tabIndex:t.props.tabIndex}))}),e},e.prototype.getChildSections=function(){var t=this,e=[],o=this.props.notebook.sections;return o&&o.forEach(function(o){var n=t.props.path+" > "+o.name;e.push(m.component(r.SectionComponent,{section:o,curSectionId:t.props.curSectionId,onSectionClicked:t.props.onSectionClicked,path:n,parentId:t.props.notebook.id,tabIndex:t.props.tabIndex}))}),e},e.prototype.getEntityClassName=function(){return"Notebook"},e.prototype.getId=function(){return this.props.notebook.id},e.prototype.getImageClassName=function(){return"NotebookImage"},e.prototype.getImagePath=function(){return a.Utils.getImageResourceUrl("notebook.png")},e.prototype.getLabel=function(){return this.props.notebook.name},e}(i.ExpandableEntityComponentBase),p=c.componentize();o.NotebookComponent=p},{"../../utils":16,"./expandableEntityComponentBase":3,"./sectionComponent":9,"./sectionGroupComponent":10}],6:[function(t,e,o){"use strict";var n=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},i=t("./notebookComponent"),r=t("../componentBase"),s=t("../../constants"),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasScrolledIntoView=!1,e}return n(e,t),e.prototype.onSectionClicked=function(t){this.props.onSectionClicked(t)},e.prototype.generateCurSectionIdPath=function(){var t=this,e=OneNoteApi.NotebookUtils.getPathFromNotebooksToSection(this.props.notebooks,function(e){return e.id===t.props.curSectionId});return e?e.map(function(t){return t.id}):void 0},e.prototype.scrollToCurrentSection=function(){if(this.props.curSectionId&&!this.hasScrolledIntoView){var t=document.getElementById(this.props.curSectionId);t&&t.scrollIntoView&&t.scrollIntoView(),this.hasScrolledIntoView=!0}},e.prototype.render=function(){var t=this,e=[],o=this.generateCurSectionIdPath();return this.props.notebooks.forEach(function(n){e.push(m.component(i.NotebookComponent,{notebook:n,curSectionId:t.props.curSectionId,path:n.name,onSectionClicked:t.onSectionClicked.bind(t),curSectionIdPath:o,tabIndex:t.props.rowTabIndex}))}),{tag:"ul",attrs:{id:s.Constants.Ids.notebookList,className:"SectionPickerState SectionPicker",style:"display: block;",config:this.scrollToCurrentSection.bind(this),role:"tree"},children:[e]}},e}(r.ComponentBase),c=a.componentize();o.NotebookListComponent=c},{"../../constants":12,"../componentBase":1,"./notebookComponent":5}],7:[function(t,e,o){"use strict";var n=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},i=t("./currentlySelectedSectionComponent"),r=t("./oneNotePickerPopupComponent"),s=t("../../constants"),a=t("../componentBase"),c=t("../../status"),p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.getInitialState=function(){return{popupVisible:!1}},e.prototype.onSectionLocationContainerClicked=function(){var t=!this.state.popupVisible;this.setState({popupVisible:t}),this.props.onPopupToggle(t)},e.prototype.onSectionClicked=function(t){this.setState({popupVisible:!1}),this.props.onSectionClicked(t),this.props.onPopupToggle(!1)},e.prototype.getStatusEnumFromString=function(t){switch(t){case"Succeeded":return c.Status.Succeeded;case"InProgress":return c.Status.InProgress;case"Failed":return c.Status.Failed;case"NotStarted":return c.Status.NotStarted;default:throw Error("Invalid status passed into OneNotePickerComponent: "+t)}},e.prototype.getTextToDisplayFromStatus=function(t){var e;switch(t){case c.Status.Succeeded:if(!this.props.textToDisplay)throw Error("Status is Succeeded but no text passed in to display to user");e=this.props.textToDisplay;break;case c.Status.InProgress:case c.Status.NotStarted:e=this.props.localizedStrings.loadingNotebooks;break;case c.Status.Failed:e=this.props.localizedStrings.defaultLocation;break;default:throw Error("Invalid status passed into getTextToDisplayFromStatus in OneNotePickerComponent: "+t)}return e},e.prototype.attachEscapeListener=function(t,e,o){var n=this;if(!e){var i=document.onkeydown;document.onkeydown=function(t){return t.keyCode===s.Constants.KeyCodes.esc&&n.state.popupVisible?void n.setState({popupVisible:!1}):void(i&&i.call(document,t))},o.onunload=function(){document.onkeydown=i?i.bind(document):void 0}}},e.prototype.render=function(){var t=this.getStatusEnumFromString(this.props.status),e=this.getTextToDisplayFromStatus(t);return{tag:"div",attrs:{id:s.Constants.Ids.oneNotePickerComponent,config:this.attachEscapeListener.bind(this)},children:[m.component(i.CurrentlySelectedSectionComponent,{textToDisplay:e,onSectionLocationContainerClicked:this.onSectionLocationContainerClicked.bind(this),tabIndex:this.props.tabIndex,expanded:this.state.popupVisible}),this.state.popupVisible?m.component(r.OneNotePickerPopupComponent,{notebooks:this.props.notebooks,status:t,onSectionClicked:this.onSectionClicked.bind(this),curSectionId:this.props.curSectionId,noNotebooksFound:this.props.localizedStrings.noNotebooksFound,notebookLoadFailureMessage:this.props.localizedStrings.notebookLoadFailureMessage,rowTabIndex:this.props.tabIndex}):void 0]}},e}(a.ComponentBase),u=p.componentize();o.OneNotePickerComponent=u},{"../../constants":12,"../../status":15,"../componentBase":1,"./currentlySelectedSectionComponent":2,"./oneNotePickerPopupComponent":8}],8:[function(t,e,o){"use strict";var n=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},i=t("./notebookListComponent"),r=t("./loadingElementComponent"),s=t("./sectionPickerPopupMessageComponent"),a=t("../componentBase"),c=t("../../constants"),p=t("../../status"),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.handlePopoverInsertion=function(t){var e=document.getElementById(c.Constants.Ids.saveToLocationContainer);if(e){var o=e.getBoundingClientRect();t.style.width=o.width+"px"}},e.prototype.render=function(){var t;return t=this.props.status===p.Status.InProgress||this.props.status===p.Status.NotStarted?m.component(r.LoadingElementComponent,{prop:!0}):this.props.status===p.Status.Failed?m.component(s.SectionPickerPopupMessageComponent,{message:this.props.notebookLoadFailureMessage}):this.props.notebooks&&0!==this.props.notebooks.length?m.component(i.NotebookListComponent,{curSectionId:this.props.curSectionId,onSectionClicked:this.props.onSectionClicked,notebooks:this.props.notebooks,rowTabIndex:this.props.rowTabIndex}):m.component(s.SectionPickerPopupMessageComponent,{message:this.props.noNotebooksFound}),{tag:"div",attrs:Object.assign({className:"SectionPickerPopup"},this.onElementDraw(this.handlePopoverInsertion)),children:[{tag:"div",attrs:{id:c.Constants.Ids.sectionPickerContainer,className:"SectionPickerContainer"},children:[t]}]}},e}(a.ComponentBase),d=u.componentize();o.OneNotePickerPopupComponent=d},{"../../constants":12,"../../status":15,"../componentBase":1,"./loadingElementComponent":4,"./notebookListComponent":6,"./sectionPickerPopupMessageComponent":11}],9:[function(t,e,o){"use strict";var n=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},i=t("../componentBase"),r=t("../../utils"),s=function(t){function e(e){var o=t.call(this,e)||this;return o.sectionInfo={section:e.section,path:e.path,parentId:e.parentId},e.curSectionId&&(o.sectionInfo.curSectionId=e.curSectionId),o}return n(e,t),e.prototype.render=function(){var t=this.props.curSectionId===this.props.section.id,e="EntityImageAndNameContainer"+(t?" SelectedSection":"");return{tag:"li",attrs:Object.assign({role:"treeitem",id:this.props.section.id,className:"Section","aria-selected":t},this.enableInvoke(this.props.onSectionClicked,this.props.tabIndex,this.sectionInfo)),children:[{tag:"div",attrs:{className:e},children:[{tag:"div",attrs:{className:"ExpandCollapseContainer"},children:[{tag:"div",attrs:{className:"Expand"},children:[{tag:"img",attrs:{className:"ExpandImage",src:r.Utils.getImageResourceUrl("arrow_right.png")}}]}]},{tag:"div",attrs:{className:"EntityImage"},children:[{tag:"img",attrs:{className:"SectionImage",src:r.Utils.getImageResourceUrl("section.png")}}]},{tag:"div",attrs:{className:"EntityNameContainer"},children:[{tag:"label",attrs:{className:"EntityName"},children:[this.props.section.name]}]}]}]}},e}(i.ComponentBase),a=s.componentize();o.SectionComponent=a},{"../../utils":16,"../componentBase":1}],10:[function(t,e,o){"use strict";var n=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},i=t("./expandableEntityComponentBase"),r=t("./sectionComponent"),s=t("./sectionGroupComponent"),a=t("../../utils"),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.getDirectChildren=function(){var t=this.getChildSectionGroups(),e=this.getChildSections();return e.forEach(function(e){t.push(e)}),t},e.prototype.getChildSectionGroups=function(){var t=this,e=[],o=this.props.sectionGroup.sectionGroups;return o&&o.forEach(function(o){var n,i=t.props.path+" > "+o.name;t.isPartOfCurSectionIdPath()&&(n=t.props.curSectionIdPath.splice(1)),e.push(m.component(s.SectionGroupComponent,{curSectionId:t.props.curSectionId,path:i,sectionGroup:o,onSectionClicked:t.props.onSectionClicked,curSectionIdPath:n,tabIndex:t.props.tabIndex}))}),e},e.prototype.getChildSections=function(){var t=this,e=[],o=this.props.sectionGroup.sections;return o&&o.forEach(function(o){var n,i=t.props.path+" > "+o.name;t.isPartOfCurSectionIdPath()&&(n=t.props.curSectionIdPath.splice(1)),e.push(m.component(r.SectionComponent,{section:o,curSectionId:t.props.curSectionId,onSectionClicked:t.props.onSectionClicked,path:i,parentId:t.props.sectionGroup.id,curSectionIdPath:n,tabIndex:t.props.tabIndex}))}),e},e.prototype.getEntityClassName=function(){return"SectionGroup"},e.prototype.getId=function(){return this.props.sectionGroup.id},e.prototype.getImageClassName=function(){return"SectionGroupImage"},e.prototype.getImagePath=function(){return a.Utils.getImageResourceUrl("section_group.png")},e.prototype.getLabel=function(){return this.props.sectionGroup.name},e}(i.ExpandableEntityComponentBase),p=c.componentize();o.SectionGroupComponent=p},{"../../utils":16,"./expandableEntityComponentBase":3,"./sectionComponent":9,"./sectionGroupComponent":10}],11:[function(t,e,o){"use strict";var n=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},i=t("../componentBase"),r=t("../../constants"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.render=function(){var t=this.props.message?this.props.message.trim():"";return{tag:"label",attrs:{id:r.Constants.Ids.sectionPickerPopupMessage,className:"SectionPickerState SectionPickerPopupMessage"},children:[m.trust(t)]}},e}(i.ComponentBase),a=s.componentize();o.SectionPickerPopupMessageComponent=a},{"../../constants":12,"../componentBase":1}],12:[function(t,e,o){"use strict";var n;!function(t){var e;!function(t){t.saveToLocationContainer="saveToLocationContainer",t.sectionLocationContainer="sectionLocationContainer",t.loadingImage="loadingImage",t.notebookList="notebookList",t.sectionPickerContainer="sectionPickerContainer",t.sectionPickerPopupMessage="sectionPickerPopupMessage",t.oneNotePickerComponent="oneNotePickerComponent"}(e=t.Ids||(t.Ids={}));var o;!function(t){t.esc=27}(o=t.KeyCodes||(t.KeyCodes={}))}(n=o.Constants||(o.Constants={}))},{}],13:[function(t,e,o){"use strict";var n=t("./UI/components/oneNotePickerComponent");o.OneNotePickerComponent=n.OneNotePickerComponent;var i=t("./oneNotePickerDataSource");o.OneNotePickerDataSource=i.OneNotePickerDataSource},{"./UI/components/oneNotePickerComponent":7,"./oneNotePickerDataSource":14}],14:[function(t,e,o){"use strict";var n=function(){function t(t){this.maxExpandedSections=4,this.authToken=t}return t.prototype.getNotebooks=function(t){var e=this,o=new OneNoteApi.OneNoteApi(this.authToken,void 0,t);return new Promise(function(t,n){o.getNotebooksWithExpandedSections(e.maxExpandedSections).then(function(e){var o=e.parsedResponse.value;e.parsedResponse=o,t(e)},function(t){n(t)})})},t}();o.OneNotePickerDataSource=n},{}],15:[function(t,e,o){"use strict";var n;!function(t){t[t.NotStarted=0]="NotStarted",t[t.InProgress=1]="InProgress",t[t.Succeeded=2]="Succeeded",t[t.Failed=3]="Failed"}(n=o.Status||(o.Status={}))},{}],16:[function(t,e,o){"use strict";var n;!function(t){function e(t){return("images/"+t).toLowerCase()}t.getImageResourceUrl=e}(n=o.Utils||(o.Utils={}))},{}]},{},[13])(13)});